<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>WEALTHOPIA — Order Form</title>

<style>
:root{
  --bg:#ffffff;
  --card:#f6f6f6;
  --soft:#ffffff;
  --text:#111111;
  --muted:#666666;
  --line:#e5e5e5;
}

*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
header{padding:22px 16px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#fff;z-index:10}
.wrap{max-width:1100px;margin:0 auto}
h1{margin:0;font-size:22px}
.sub{color:var(--muted);margin-top:6px;font-size:13px}
main{padding:18px 16px 40px}
.grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}

.panel{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
.panel-h{padding:14px;border-bottom:1px solid var(--line);display:flex;justify-content:space-between}
.panel-b{padding:14px}

.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{border:1px solid var(--line);background:transparent;padding:8px 10px;border-radius:999px;cursor:pointer;font-size:12px}
.tab[aria-selected="true"]{box-shadow:0 0 0 2px rgba(0,0,0,.1) inset}

.items{margin-top:12px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
@media(max-width:560px){.items{grid-template-columns:1fr}}

.itembtn{
  border:1px solid var(--line);
  background:#fff;
  border-radius:14px;
  padding:12px;
  cursor:pointer;
  display:flex;
  justify-content:space-between;
  text-align:left;
}
.itembtn small{color:var(--muted)}

.selector{margin-top:12px;border:1px solid var(--line);border-radius:14px;padding:12px;display:none;gap:10px;background:#fff}
.row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
input,textarea,select{
  width:100%;padding:10px;border:1px solid var(--line);border-radius:12px;background:#fff
}
input[type="number"]{max-width:120px}

.btn{border:1px solid var(--line);background:#fff;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600}
.btn-primary{background:#111;color:#fff}
.btn-danger{background:#fff}

.cart{display:flex;flex-direction:column;gap:10px}
.cart-item{border:1px solid var(--line);border-radius:14px;padding:12px;display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}

.totalbox{border-top:1px solid var(--line);margin-top:12px;padding-top:12px;display:grid;gap:6px}
.kv{display:flex;justify-content:space-between;font-size:14px}
.muted{color:var(--muted);font-size:12px}

.ticket-area{display:none;margin-top:14px;border:1px solid var(--line);border-radius:14px;padding:14px;text-align:center;background:#fff}
.ticket-template{margin-top:10px;border:1px solid var(--line);border-radius:12px;padding:10px;white-space:pre-wrap;text-align:left}

.two-col{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:560px){.two-col{grid-template-columns:1fr}}
</style>
</head>

<body>
<header>
<div class="wrap">
<h1>WEALTHOPIA — Order Form</h1>
<div class="sub">Minimal transaksi gabungan Rp3.500 (kecuali pure quest).</div>
</div>
</header>

<main class="wrap">
<div class="grid">

<section class="panel">
<div class="panel-h"><strong>Pilih Item</strong></div>
<div class="panel-b">
<div class="tabs" id="tabs"></div>
<div class="items" id="items"></div>

<div class="selector" id="selector">
<div id="selTitle"></div>
<div class="row">
<input type="number" id="selQty" value="0" min="0"/>
<button class="btn" id="minusBtn">-</button>
<button class="btn" id="plusBtn">+</button>
<button class="btn btn-primary" id="addBtn">Tambah</button>
</div>
</div>
</div>
</section>

<aside class="panel">
<div class="panel-h"><strong>Keranjang</strong></div>
<div class="panel-b">

<div class="cart" id="cart"></div>
<button class="btn btn-danger" id="clearBtn" style="display:none">Kosongkan Keranjang</button>

<div class="totalbox">
<div class="kv"><span>Total Qty</span><strong id="totalQty">0</strong></div>
<div class="kv" id="handlingRow" style="display:none"><span>Handling Multi Area</span><strong id="handlingFee">Rp0</strong></div>
<div class="kv"><span>Total Harga</span><strong id="totalPrice">Rp0</strong></div>
<div class="muted" id="ruleMsg"></div>
</div>

<hr>

<div style="display:grid;gap:10px">
<input id="custName" placeholder="Nama / Inisial"/>
<input id="custUser" placeholder="Username Telegram"/>
<select id="loginMethod">
<option value="">Metode Login</option>
<option>Google</option>
<option>Facebook</option>
</select>
<textarea id="custNote" placeholder="Catatan (opsional)"></textarea>

<button class="btn btn-primary" id="orderBtn">Order Sekarang</button>

<div class="ticket-area" id="ticketArea">
<div id="ticketCode"></div>
<div class="ticket-template" id="ticketTemplate"></div>
<button class="btn btn-primary" id="copyBtn">Salin Tiket</button>
<a href="https://t.me/wealthopiabot" target="_blank" class="btn">Buka Bot</a>
</div>
</div>

</div>
</aside>

</div>
</main>

<script>
const BOT_TOKEN="8289857502:AAFelp66rhaB4MXBxKQAPnqafhbiK-EwDjE";
const CHAT_ID="-1003862510166";

const CATALOG={
"Fruits":[
{id:"blueberry",label:"Blueberry",price:30,type:"farm"},
{id:"apple",label:"Apple",price:30,type:"farm"},
{id:"rasberry",label:"Rasberry",price:40,type:"farm"},
{id:"mandarin",label:"Mandarin",price:40,type:"farm"}
],
"Mushrooms":[
{id:"oyster",label:"Oyster",price:25,type:"farm"},
{id:"shiitake",label:"Shiitake",price:25,type:"farm"},
{id:"button",label:"Button",price:25,type:"farm"},
{id:"pennybun",label:"Pennybun",price:25,type:"farm"}
],
"Materials":[
{id:"stone",label:"Stone",price:23,type:"farm",min150:true},
{id:"ore",label:"Ore",price:28,type:"farm",min150:true}
],
"Timber Package":[
{id:"A",label:"Pack A (200+30)",packPrice:7500,type:"timber"},
{id:"B",label:"Pack B (300+60)",packPrice:11000,type:"timber"},
{id:"C",label:"Pack C (400+90)",packPrice:15000,type:"timber"},
{id:"D",label:"Pack D (500+120)",packPrice:18500,type:"timber"},
{id:"E",label:"Pack E (600+150)",packPrice:22000,type:"timber"}
],
"JOKI-QUEST / STORY":[
{id:"daily",label:"Daily Quest",type:"daily"},
{id:"weekly",label:"Weekly Quest (4.000)",price:4000,type:"quest"},
{id:"main",label:"Main Quest (6.000)",price:6000,type:"quest"},
{id:"gossip",label:"Gossip Quest (4.000)",price:4000,type:"quest"},
{id:"fullweek",label:"Full Week (35 Daily)",price:85000,type:"quest"},
{id:"completeweek",label:"Complete Week (35 Daily + Weekly)",price:89000,type:"quest"}
]
};

let cart={};
let activeTab=Object.keys(CATALOG)[0];
let selected=null;

function rupiah(n){return"Rp"+n.toLocaleString("id-ID")}
function dailyPrice(q){
const full=Math.floor(q/5);
const sisa=q%5;
return(full*14000)+(sisa*3000)
}

function handlingFee(){
const farmItems=Object.values(cart).filter(i=>i.type==="farm");
if(farmItems.length<=1)return 0;
if(farmItems.length===2)return 1500;
return(farmItems.length-1)*1000;
}

function totals(){
let qty=0,price=0;
Object.values(cart).forEach(i=>{
if(i.type==="daily"){
price+=dailyPrice(i.qty);
}else if(i.type==="farm"){
price+=i.qty*i.price;
qty+=i.qty;
}else if(i.type==="timber"){
price+=i.qty*i.packPrice;
}else{
price+=i.qty*i.price;
}
});
return{qty,price}
}

function validate(){
const {qty,price}=totals();
const farmItems=Object.values(cart).filter(i=>i.type==="farm");
if(farmItems.length){
if(qty<100)return"Minimal qty farming 100";
if(price<3500)return"Minimal transaksi gabungan Rp3.500";
farmItems.forEach(i=>{
if(i.min150 && farmItems.length===1 && i.qty<150){
return"Stone/Ore minimal 150 jika berdiri sendiri";
}
});
}
return"";
}

function render(){
const itemsEl=document.getElementById("items");
itemsEl.innerHTML="";
CATALOG[activeTab].forEach(it=>{
const b=document.createElement("button");
b.className="itembtn";
b.innerHTML=`<div>${it.label}</div><small>${it.price?rupiah(it.price):it.packPrice?rupiah(it.packPrice):""}</small>`;
b.onclick=()=>{selected=it;document.getElementById("selector").style.display="block";document.getElementById("selTitle").innerText=it.label}
itemsEl.appendChild(b);
});
renderCart();
}

function renderCart(){
const cartEl=document.getElementById("cart");
cartEl.innerHTML="";
Object.values(cart).forEach(i=>{
const d=document.createElement("div");
d.className="cart-item";
d.innerHTML=`<div>${i.label} (${i.qty})</div><button class="btn btn-danger">X</button>`;
d.querySelector("button").onclick=()=>{delete cart[i.id];render()}
cartEl.appendChild(d);
});
document.getElementById("clearBtn").style.display=Object.keys(cart).length?"block":"none";

const {qty,price}=totals();
document.getElementById("totalQty").innerText=qty;
const h=handlingFee();
if(h){document.getElementById("handlingRow").style.display="flex";document.getElementById("handlingFee").innerText=rupiah(h);price+=h}else{
document.getElementById("handlingRow").style.display="none"
}
document.getElementById("totalPrice").innerText=rupiah(price);
document.getElementById("ruleMsg").innerText=validate();
}

document.getElementById("addBtn").onclick=()=>{
if(!selected)return;
let q=parseInt(document.getElementById("selQty").value)||0;
if(q<=0)return;
if(!cart[selected.id])cart[selected.id]={...selected,qty:0};
cart[selected.id].qty+=q;
document.getElementById("selQty").value=0;
render();
};

document.getElementById("clearBtn").onclick=()=>{cart={};render()};

document.getElementById("orderBtn").onclick=async()=>{
const error=validate();
if(error){alert(error);return;}
const name=document.getElementById("custName").value.trim();
const user=document.getElementById("custUser").value.trim();
const login=document.getElementById("loginMethod").value;
if(!name||!user||!login){alert("Field wajib belum diisi");return;}

const ticket="#"+user.replace("@","")+Math.floor(100+Math.random()*900)+"WTP"+new Date().toISOString().slice(0,10).replace(/-/g,"");

const {price}=totals();
const total=price+handlingFee();

await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
chat_id:CHAT_ID,
text:`${ticket}\nNama:${name}\nUsername:@${user}\nLogin:${login}\nTotal:${rupiah(total)}`
})
});

document.getElementById("ticketArea").style.display="block";
document.getElementById("ticketCode").innerText=ticket;
document.getElementById("ticketTemplate").innerText=`Halo, aku mau order yaa. Ini tiketnya : ${ticket}. Untuk pembayarannya aku mau via QRIS.`;
navigator.clipboard.writeText(document.getElementById("ticketTemplate").innerText);
};

document.getElementById("copyBtn").onclick=()=>{
navigator.clipboard.writeText(document.getElementById("ticketTemplate").innerText);
};

Object.keys(CATALOG).forEach(cat=>{
const t=document.createElement("button");
t.className="tab";
t.innerText=cat;
t.onclick=()=>{activeTab=cat;render()}
document.getElementById("tabs").appendChild(t);
});

render();
</script>
</body>
</html>
